<!DOCTYPE html>
<html>
<head>
    <title>Employee Detail</title>
</head>
<body>

<h1>
    {{ employee['first_name'] }} {{ employee['last_name'] }}
    ({{ employee['employment_type']|capitalize }})
</h1>

<p>Status: {{ employee['status']|capitalize }}</p>

<p>
    <strong>Phone:</strong> {{ employee['phone'] or '—' }}<br>
    <strong>Email:</strong> {{ employee['email'] or '—' }}
</p>

<p>
    <a href="{{ url_for('employees_list') }}">← Back to Employees</a> |
    <a href="{{ url_for('dashboard') }}">Dashboard</a>
</p>

{% with messages = get_flashed_messages() %}
    {% if messages %}
    <div style="color: green;">
        <ul>
            {% for msg in messages %}
                <li>{{ msg }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
{% endwith %}

{% if errors %}
    <div style="color: red;">
        <ul>
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<hr>

<h2>PTO Balances</h2>

{% if balances %}
<table border="1" cellpadding="6" cellspacing="0">
    <thead>
        <tr>
            <th>PTO Type</th>
            <th>Allotted (hrs)</th>
            <th>Used (hrs)</th>
            <th>Remaining (hrs)</th>
        </tr>
    </thead>
    <tbody>
    {% for b in balances %}
        <tr>
            <td>{{ b['pto_name'] }}</td>
            <td>{{ "%.2f"|format(b['hours_allotted']) }}</td>
            <td>{{ "%.2f"|format(b['hours_used']) }}</td>
            <td>{{ "%.2f"|format(b['hours_remaining']) }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>No PTO balances found for this employee.</p>
{% endif %}

{% if is_admin %}
<hr>

<h3 id="balances-edit">Edit PTO Balances (Admin)</h3>

<form method="POST" action="{{ url_for('employee_detail', employee_id=employee['id']) }}#balances-edit">
    {% if not balance_rows %}
        <p>No active PTO types available.</p>
    {% else %}
    <table border="1" cellpadding="6" cellspacing="0">
        <thead>
            <tr>
                <th>PTO Type</th>
                <th>Hours Allotted</th>
                <th>Hours Used</th>
                <th>Remaining</th>
            </tr>
        </thead>
        <tbody>
        {% for row in balance_rows %}
            <tr>
                <td>{{ row.display_name }}</td>
                <td>
                    <input
                        type="number"
                        name="{{ row.pto_type_id }}"
                        step="0.25"
                        min="{{ '%.2f'|format(row.hours_used) }}"
                        value="{{ row.input_value }}"
                        required
                    >
                </td>
                <td>{{ "%.2f"|format(row.hours_used) }}</td>
                <td>
                    {% if row.remaining is none %}
                        N/A
                    {% else %}
                        {{ "%.2f"|format(row.remaining) }}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <p style="margin-top: 10px;">Hours allotted cannot be less than hours already used.</p>
    <button type="submit">Save Balances</button>
    {% endif %}
</form>
{% endif %}

<hr>

<h2>PTO History</h2>

<p>
  <a href="{{ url_for('pto_entry_new', employee_id=employee['id']) }}">+ Add PTO Entry</a>
</p>
S

{% if pto_entries %}
<table border="1" cellpadding="6" cellspacing="0">
    <thead>
        <tr>
            <th>PTO Type</th>
            <th>Start</th>
            <th>End</th>
            <th>Hours</th>
            <th>Notes</th>
            <th>Created By</th>
            <th>Created At</th>
        </tr>
    </thead>
    <tbody>
    {% for e in pto_entries %}
        <tr>
            <td>{{ e['pto_name'] }}</td>
            <td>{{ e['start_date'] }}</td>
            <td>{{ e['end_date'] }}</td>
            <td>{{ e['hours'] if e['hours'] is not none else '—' }}</td>
            <td>{{ e['notes'] or '' }}</td>
            <td>{{ e['manager_name'] or '—' }}</td>
            <td>{{ e['created_at'] }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>No PTO entries yet for this employee.</p>
{% endif %}

</body>
</html>
